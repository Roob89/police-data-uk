<!doctype html>
<html lang="en">

<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Force</title>
    
    <!-- Styles -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">


</head>

<body>

    <!-- Basic Information -->
<div class="container inner-margin">
    <div class="card">
        <h1 id="name">[ . . . ]</h1>
        <p id="description">[ . . . ]</p>
        <h4>URL</h4>
        <p id="url">[ . . . ]</p>
        <h4>Tel</h4>
        <p id="telephone">[ . . . ]</p>
        <h4>Engagement methods</h4>
        <ul id="engagement-methods">
            [...]
        </ul>
    </div>
</div>

<!-- Neighbourhoods  -->
<div class="container inner-margin">
    <div class="card">
        <h2>Neighbourhoods </h2>
        <div id="neighbourhoods-container" class="row">
            <li>[ . . . ]</li>
        </div>
    </div>
</div>

<!-- Senior officers -->
<div class="container inner-margin">
    <div class="card">
        <h2>Senior officers</h2>
        <div class="card-body">
            <div id="senior-officer-container">[ . . . ]</div>
        </div>
    </div>
</div>


<script>

    // Get data from url
    var url_string = window.location.href;
    var url = new URL(url_string);
    var id = url.searchParams.get("id");
    var response;

    // API call
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "https://data.police.uk/api/forces/" + id, true);
    xhttp.send();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            response = this.responseText;
            response = JSON.parse(response);

            console.log( response );

            updateBasicDetails();
            updateEngagementMethods();

        }
    };

    // Update basic details
    function updateBasicDetails(){
        
        document.getElementById('name').innerHTML = response.name;
        document.getElementById('description').innerHTML = response.description;
        document.getElementById('url').innerHTML = response.url;
        document.getElementById('telephone').innerHTML = response.telephone;
        
    }

    // Update engagement methods
    function updateEngagementMethods(){

        engagementMethods = response.engagement_methods;
        newHTML = '';
        for (var i = 0; i < engagementMethods.length; i++) {
            var obj = engagementMethods[i];
            if( obj.url != '' ) {
                newHTML = newHTML + `<li><a href="${obj.url}" type="${obj.type}" target="_blank" rel="nofollow noreferrer noopener">${obj.title}</a></li>`;
            } else {
                newHTML = newHTML + `<li>${obj.title}</li>`;
            }
        }
        document.getElementById('engagement-methods').innerHTML = newHTML;

    }


    // Neighbourhoods
    var xhttp = new XMLHttpRequest();
    xhttp.open("GET", "https://data.police.uk/api/"+id+'/neighbourhoods', true);
    xhttp.send();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            // Parse the response
            var response = this.responseText;
            response = JSON.parse(response);
            
            // Loop
            newHTML = '';
            if( response.length > 0 ) {
                for (var i = 0; i < response.length; i++) {
                    var obj = response[i];
                    newHTML = newHTML + `
                    <div class="col-12 col-md-4">
                        <div class="mt-2 mb-2">
                            <a href="/neighbourhood?force=` + id + `&id=` + obj.id + `">` + obj.name + `</a>                            
                        </div>
                    </div>`;
                    }
                }
                
                // Update DOM
                document.getElementById('neighbourhoods-container').innerHTML = newHTML;
            
        }
    }

    // Senior Officer API request
    var xhttp = new XMLHttpRequest();
    var response = null;
    xhttp.open("GET", "https://data.police.uk/api/forces/"+id+'/people', true);
    xhttp.send();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {

            // Parse response
            response = this.responseText;
            response = JSON.parse(response);

            // Loop through the results
            var newHTML = '';
            if( response.length > 0 ) {

                // Generate new html
                for (var i = 0; i < response.length; i++) {

                    // Variables
                    var obj = response[i];

                    // Basic details
                    newHTML = newHTML + `
                        <hr>
                        <h2>` + obj.name + `</h2>
                        <sub>` + obj.rank + `</sub>
                        <p>` + obj.bio + `</p>
                    `;

                    // Contact
                    if( obj.contact_details.twitter != '' ) {
                        newHTML = newHTML + `<a href="` + obj.contact_details.twitter + `" target="_blank" rel="nofollow noreferrer">` + obj.contact_details.twitter + `</a>`;
                    }

                }

            } else {

                // No senior officer details
                newHTML = '<p>No data available at this moment.</p>'

            }

            // Update DOM
            document.getElementById('senior-officer-container').innerHTML = newHTML;

        }
    };

</script>

    <!-- Scripts -->
    <script src=""></script>

</body>

</html>